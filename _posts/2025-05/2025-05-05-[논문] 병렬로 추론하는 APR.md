---
title: "[논문] 병렬로 LLM을 추론하는 APR"
date: 2025-05-05
tags: [LLM, 병렬, Parallel, ]
typora-root-url: ../
---

지난 주 블로글에서 셀러브래스(Cerebras)와 그록(Groq) 회사가 Llama API를 통해 더 빠른 추론 속도를 서비스를 제공하겠다는 라마콘 소식을 올렸는 데, 오늘은 UC 버클리와 UCSF 연구진이 공동으로 발표한 병렬로 LLM 추론하는 APR에 대한 논문을 읽고 흥미로워서 오랜만에 논문을 요점정리하는 블로그를 진행하고자 한다.  



## 1. 논문이 나오게 된 배경

* 대규모 언어 모델(LLM)은 OpenAI의 o1이나 DeepSeekR1처럼 Test-time compute을 활용한 검색 및 강화학습을 통해 성능을 최적화하듯 추론 영역에서도 큰 진보를 이끌어 냄. 
* 직렬 체인 오브 싱킹(Serialized Chain-of-Thought) 방식은 출력 시퀀스가 지나치게 길어져 지연(latency)이 증가하고, 컨텍스트 윈도우 한계를 초과하는 문제를 유발함.
* Best-of-N, Self-Consistency와 같은 병렬 추론 기법은 각 추론 경로 간의 조정이 부족하고, 엔드 투 엔드 최적화가 이뤄지지 않아 계산 효율성이 떨어지며 성능 향상에도 제한함.
* Tree-of-Thought와 같은 구조화된 추론 기법은 사람이 설계한 검색 구조에 의존하므로, 다양한 추론 작업이나 도메인에 걸쳐 확장성과 유연성이 떨어짐.



## 2. LLM 추론의 계산 문제 해결 방안의 문제점

* **추론 시점에서 계산량을 늘려 성능을 높이는 방법:** 출력 시퀀스를 지나치게 길게 만들어 지연을 초래하고, 모든 추론 경로를 하나의 컨텍스트 윈도우에 넣어야 하는 부담을 줌.
* **앙상블 기반의 병렬화 전략:** 여러 모델 호출을 동시에 실행하지만, 경로 간의 조정이 미흡해 중복 계산과 비효율적 자원 활용
* **Tree-of-Thought나 멀티 에이전트 방식:** 병렬 추론 구조를 고정적으로 설계하지만, 확장성과 유연성에 한계
* **PASTA 접근 방식:** 작업을 병렬 하위 작업으로 나누지만, 결국 전체 컨텍스트를 메인 추론 경로로 재통합함으로써 컨텍스트 사용량 감소에 실패함.
* **Hogwild! 추론:** 병렬 워커 스레드를 활용하지만, 단순 프롬프트 기반이며 엔드 투 엔드 최적화는 적용되지 않음



## 3. 적응형 병렬 추론(APR)의 탄생

* **적응형 병렬 추론(APR, Adaptive Parallel Reasoning)** 
  * 언어 모델이 추론 시점에서 직렬 연산과 병렬 연산을 동적으로 분배할 수 있도록 설계됨.
  * 기존의 직렬 체인 오브 싱킹, 병렬 자기 일관성(Self-Consistency) 추론, 구조화된 검색 등을 일반화하여, 모델이 언제, 어떻게 병렬화할지 스스로 결정하도록 훈련
* 부모-자식 스레딩 메커니즘
  * 부모 추론 스레드가 `spawn()` 연산을 통해 여러 자식 스레드에 하위 작업을 병렬로 분배
  * 각 자식 스레드는 결과를 `join()` 연산을 통해 부모에게 반환함으로써 추론을 이어감
  * SGLang 모델 서빙 프레임워크 위에 구축되어, 자식 스레드에서의 병렬 추론을 배치 처리로 효율적으로 실행하여 실시간 지연을 대폭 줄임.
* 엔드 투 엔드 강화학습 기반의 파인튜닝
  * 미리 정의된 추론 구조 없이, 작업 성공률을 극대화하기 위해 전체 추론 과정을 최적화함



## 4. 적응형 병렬 추론 장점

* 고정된 컨텍스트 윈도우 내에서 더 높은 성능을 달성
*  계산 자원이 늘어날수록 성능이 안정적으로 확장
* 동일한 지연 시간에서 기존 방식보다 우수한 추론 결과



## 4. 적응형 병렬 추론 장점

* 고정된 컨텍스트 윈도우 내에서 더 높은 성능을 달성
* 





참고: https://www.marktechpost.com/2025/05/02/llms-can-now-reason-in-parallel-uc-berkeley-and-ucsf-researchers-introduce-adaptive-parallel-reasoning-to-scale-inference-efficiently-without-exceeding-context-windows/

