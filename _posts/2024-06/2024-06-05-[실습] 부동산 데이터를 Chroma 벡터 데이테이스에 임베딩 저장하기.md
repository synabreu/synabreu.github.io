---
title: "[실습] 부동산 데이터를 Chroma 벡터 데이테이스에 임베딩 저장하기"
date: 2024-06-05
tags: [마이크로소프트, Microsoft, 오픈AI, OpenAI, Chroma, VectorDB, RAG]
typora-root-url: ../
toc: true
categories: [Microsoft, OpenAI, Chroma]
---

간단한 부동산 정보 데이터를 크로마(Chroma) 벡터 데이터베이스에 임베딩해서 저장하고 유사성을 검색하는 핸즈 온 실습을 한번 정리해 보자! 참고로 프로그램 기본 환경은 Python 3.10.10 버전과 크로마 벡터 데이터베이스 0.6.3 버전을 사용했으며,  Embedding 데이터 저장 영역 중심으로 개발한 예제 소스 코드이다. 여러분은 아래와 같이 순서대로 따라해 보기 바란다. 



## 1. chroma 벡터 데이터베이스와 sentence_transformers 설치

* 로컬 환경의 콘솔에서 아래의 명령어에서 "!" 를 삭제하고 실행한다. 그러나, 노트북이나 구글 코드랩에서 실행할 때에는 "!"를 앞 줄에 넣고 실행한다.

```cmd
!pip install chromadb 
!pip install sentence-transformers
```



## 2. 간단한 부동산 정보를 embedding 생성하기



```python
sentences = [
    '한강 상류 근처에 위치한 세련되고 전용 발코니가 있는 방 3개가 있는 타운 하우스',
    '아늑한 벽난로가 있는 북한산 속의 평화로운 방 4개가 있는 목조 주택.',
    '공용 피트니스가 있는 활기찬 강남에 있는 세련된 오피스텔.',
    '아름다운 풍경이 펼쳐지는 전원에 위치한 매력적인 방 2개가 있는 전원 주택.',
    '넓은 거실이 있는 대학 근처의 밝은 방 1개가 있는 오피스텔.',
    '도심 한 가운데에 위치한 루프탑 테라스가 있는 모던한 방 1개와 침실 1가 있는 복층 원룸.'
]

model = SentenceTransformer('sentence-transformers/all-MiniLM-L6-v2')
embeddings = model.encode(sentences)
```



## 3. Chroma DB 클라이언트 초기화



```python
client = chromadb.Client()
```



## 4. 컬렉션 생성하면서 불러오기



```python
collection_name = "Apt101"
collection = client.get_or_create_collection(collection_name)
```



## 5. 임베딩 및 메타 데이터 저장



```python
collection.add(
    ids=[str(i) for i in range(len(sentences))],
    embeddings=embeddings.tolist(),
    metadatas=[{"description": desc} for desc in sentences]
)
```



## 6. 벡터 데이터베이스 검색을 위한 쿼리 생성



```python
query = "강남 오피스텔"
query_embeddings = model.encode([query])
```



## 7. Chroma DB 에서 유사도 검색



```python
results = collection.query(
    query_embeddings = query_embeddings.tolist(),
    n_results = 1, # 질문과 답변의 유사도가 가장 높은 순으로 개수, 1은 1개만 출력.
    include = ['metadatas', 'distances'] # 메타 데이터와 거리 값 포함
)
```



## 8. 결과 출력하기



```python
for idx, (metadata, distance) in enumerate(zip(results['metadatas'][0], results['distances'][0])):
    print(f"Result {idx+1}: {metadata['description']}(Distance: {distance})")
```



## 9. 실행 결과

![그림 1 - 실행 결과](/../images/2024-06/chroma-01.png)